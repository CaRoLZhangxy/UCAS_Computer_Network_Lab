# 流完成时间实验报告

<center>张翔雨 2018K8009929035</center>

## 一、实验题目：流完成时间实验

## 二、实验内容

- 利用fct_exp.py脚本复现P25中的图
  - 每个数据点做5次实验，取均值
- 调研解释图中的现象
  - 提示：TCP传输、慢启动机制

## 三、实验流程

- 在Python脚本中设定带宽及延迟
- 在终端中输入`sudo python fct_exp.py`
- 在终端中输入`xterm h1 h2`中启动h1、h2两个host
- 在h2 终端输入 `dd if=/dev/zero of=file_sizeMB.dat bs=1M count=file_size`,其中 file_size 分别设置为1，10，100，进行不同大小的实验
- 在h1 终端中输入`wget http://10.0.0.2/file_sizeMB.dat` 获取主机h2 上对应大小的文件
- 记录每次完成传输的时间和速度，每个数据点做五次实验，取均值
- 根据结果绘图，复现讲义上p25的图片

## 四、实验结果

### 1.带宽为10Mbps下的实验结果（默认延迟为100ms，下同）

#### （1）1MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 1.5  | 1.5  | 1.5  | 1.5  | 1.5  | 1.5  |
| 速度(MB/s) | 0.66 | 0.66 | 0.67 | 0.66 | 0.67 | 0.66 |

其中一次实验的传输结果如下

![image-20210320143002641](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320143002641.png)

#### （2）10MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 9.4  | 9.4  | 9.4  | 9.4  | 9.4  | 9.4  |
| 速度(MB/s) | 1.14 | 1.14 | 1.14 | 1.14 | 1.14 | 1.14 |

其中一次实验的传输结果如下

![image-20210320143801020](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320143801020.png)

#### （3）100MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 88   | 88   | 88   | 88   | 88   | 88   |
| 速度(MB/s) | 1.14 | 1.14 | 1.14 | 1.14 | 1.14 | 1.14 |

其中一次实验的传输结果如下

![image-20210320144207528](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320144207528.png)

### 2.带宽为50Mbps下的实验结果

#### （1）1MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  |
| 速度(MB/s) | 0.81 | 0.81 | 0.82 | 0.81 | 0.81 | 0.81 |

其中一次实验的传输结果如下

![image-20210320145208825](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320145208825.png)

#### （2）10MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 3.1  | 3.0  | 3.0  | 3.0  | 3.0  | 3.0  |
| 速度(MB/s) | 3.27 | 3.36 | 3.39 | 3.33 | 3.33 | 3.34 |

其中一次实验的传输结果如下

![image-20210320145508412](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320145508412.png)

#### （3）100MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 19   | 19   | 19   | 19   | 19   | 19   |
| 速度(MB/s) | 5.61 | 5.62 | 5.61 | 5.62 | 5.61 | 5.61 |

其中一次实验的传输结果如下

![image-20210320145956006](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320145956006.png)

### 3.带宽为100Mbps下的实验结果

#### （1）1MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  |
| 速度(MB/s) | 0.82 | 0.82 | 0.82 | 0.82 | 0.82 | 0.82 |

其中一次实验的传输结果如下

![image-20210320150832026](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320150832026.png)

#### （2）10MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 2.3  | 2.3  | 2.2  | 2.3  | 2.3  | 2.3  |
| 速度(MB/s) | 4.44 | 4.43 | 4.46 | 4.41 | 4.34 | 4.42 |

其中一次实验的传输结果如下

![image-20210320151324118](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320151324118.png)

#### （3）100MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 11   | 11   | 11   | 11   | 11   | 11   |
| 速度(MB/s) | 10.4 | 10.5 | 10.5 | 10.7 | 10.5 | 10.5 |

其中一次实验的传输结果如下

![image-20210320151435804](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320151435804.png)

### 4.带宽为500Mbps下的实验结果

#### （1）1MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  |
| 速度(MB/s) | 0.83 | 0.83 | 0.83 | 0.83 | 0.83 | 0.83 |

其中一次实验的传输结果如下

![image-20210320151812681](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320151812681.png)

#### （2）10MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 1.9  | 1.9  | 1.9  | 1.9  | 1.9  | 1.9  |
| 速度(MB/s) | 5.27 | 5.21 | 5.30 | 5.24 | 5.16 | 5.24 |

其中一次实验的传输结果如下

![image-20210320151925869](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320151925869.png)

#### （3）100MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 4.7  | 4.5  | 4.7  | 4.4  | 4.5  | 4.6  |
| 速度(MB/s) | 31.4 | 31.5 | 30.4 | 30.9 | 30.3 | 30.9 |

其中一次实验的传输结果如下

![image-20210320153035493](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320153035493.png)

### 5.带宽为1Gbps下的实验结果

#### （1）1MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  | 1.2  |
| 速度(MB/s) | 0.83 | 0.83 | 0.83 | 0.83 | 0.83 | 0.83 |

其中一次实验的传输结果如下

![image-20210320153211852](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320153211852.png)

#### （2）10MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 1.9  | 1.9  | 1.9  | 1.9  | 1.9  | 1.9  |
| 速度(MB/s) | 5.33 | 5.18 | 5.31 | 5.22 | 5.21 | 5.25 |

其中一次实验的传输结果如下

![image-20210320153426875](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320153426875.png)

#### （3）100MB数据包传输结果

进行五次实验;

| 序号       | 1    | 2    | 3    | 4    | 5    | 均值 |
| ---------- | ---- | ---- | ---- | ---- | ---- | ---- |
| 时间(s)    | 4.9  | 4.9  | 4.8  | 4.8  | 4.8  | 4.8  |
| 速度(MB/s) | 28.0 | 28.0 | 30.0 | 30.8 | 29.3 | 29.2 |

其中一次实验的传输结果如下

![image-20210320154036328](C:\Users\Samuel\AppData\Roaming\Typora\typora-user-images\image-20210320154036328.png)

### 6.延迟为10ms时，100M数据包在不同带宽下的传输情况

| 带宽(Mbps) | 10   | 50   | 100  | 500  | 1000 |
| ---------- | ---- | ---- | ---- | ---- | ---- |
| 速度(MB/s) | 1.14 | 5.57 | 10.2 | 34.0 | 33.0 |
| 时间(s)    | 88   | 18   | 9.7  | 2.9  | 3.0  |

可以看到，在相同条件，延迟为10ms时的传输速度明显快于延迟为100ms时的传输速度，在带宽较大时更为明显，这点将在稍后的分析中解释。

## 五、结果分析

### 1. 绘图

要复现讲义上p25的图，首先要使用对数坐标系，横纵坐标是带宽和FCT的改进，对于纵坐标，我们将最长的耗时作为分子，每个耗时的数据作为分母，以此作为纵坐标来体现FCT的改进（可以理解为每个点的传输速率和最慢速率的比值），横坐标则是每个带宽和最小带宽的比值，绘图如下：（绘图代码见drawing-FCT.py，相关数据见data.xlsx)

![FCT](D:\UCAS\Computer Network Lab\network-labs\Lab1-2\FCT.svg)

<center>FCT-数据包大小-带宽关系图</center>

### 2.结果分析

- 当带宽到达50Mbps时，1MB的包速率不再发生变化。
- 当带宽一定时，数据包越大，网络传输速率越高，数据包越小，网络传输速率越低；当数据包大小不变时，网络传输速率不会随着带宽线性增加，当带宽达到500Mbps后，传输速率不再增加。
- 在改变延迟的实验中发现，减小延迟可以显著增加高带宽、大数据包的传输速率，同时根据实验中观察到的现象，在数据包开始传输的一段时间内速度是较慢的，而这段时间的长短与延迟成正相关。

## 六、调研解释

### 1.TCP传输

TCP协议会将应用层的数据流分割成适当长度的报文段，最大传输段大小（[MSS](https://baike.baidu.com/item/MSS/3567770)）通常受该计算机连接的网络的数据链路层的最大传送单元（[MTU](https://baike.baidu.com/item/MTU)）限制。而TCP的传输速率是由其阻塞算法决定的，TCP拥塞算法缓慢地探测网络的可用带宽，增加传输速率直到检测到分组丢失，然后指数地降低传输速率。

当数据包大小不变带宽增加时，该算法会增加传输速率直至分组丢失，而降低传输速率时指数级的，因此速率并不会随着带宽的增加而线性增加。

同时，对数据进行分组也会造成丢包、排队、阻塞等问题，这也会影响到传输速率的增长。

### 2.慢启动机制

慢启动是TCP使用的一种阻塞控制机制。慢启动也叫做指数增长期。慢启动是指每次TCP接收窗口收到确认时都会增长。增加的大小就是已确认段的数目。这种情况一直保持到要么没有收到一些段，要么窗口大小到达预先定义的阈值。如果发生丢失事件，TCP就认为这是网络阻塞，就会采取措施减轻网络拥挤。一旦发生丢失事件或者到达阈值，TCP就会进入线性增长阶段。这时，每经过一个[RTT](https://baike.baidu.com/item/RTT)窗口增长一个段。

由于TCP连接会随着时间进行自我调谐，起初会限制连接的最大速度，如果数据传输成功，会随着时间的推移提高传输速度，这就是TCP的慢启动机制。

这样就解释了在带宽较高时，小数据包没有达到期待的网速的问题。在慢启动阶段，TCP预留的窗口大小会随着每接受到一个段而指数级增长，对于数据包大小较小的包，在窗口还没有达到带宽的阈值时可能传输就已经结束了，因此此时测得的传输速率会明显小于对应带宽的最大速率。

## 七、实验总结

这次实验主要加深了我对TCP协议的认识，实际的数据带来的直观印象比较深刻。同时绘图的过程也有助于回忆起之前课程中学到的数据处理的相关知识，也进一步熟悉了实验环境的使用，对影响网速的因素有了浅显的认识。